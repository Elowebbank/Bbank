<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  /* ---------- Cinematic Clean CSS ---------- */
  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(to right, #0f2027, #203a43, #2c5364);
    color: #f0f0f0;
    margin: 0;
    padding: 0;
  }
  h1, h2 { text-align: center; margin-bottom: 1rem; }
  .container { max-width: 1200px; margin: auto; padding: 20px; }
  .section { background: rgba(0,0,0,0.6); padding: 20px; margin-bottom: 30px; border-radius: 12px; box-shadow: 0 0 20px rgba(0,0,0,0.7); }
  input, select, button { padding: 10px; margin: 5px 0; border-radius: 6px; border: none; width: 100%; }
  button { background-color: #ff4b2b; color: white; cursor: pointer; transition: 0.3s; }
  button:hover { background-color: #ff416c; }
  table { width: 100%; border-collapse: collapse; margin-top: 15px; }
  th, td { padding: 10px; text-align: left; border-bottom: 1px solid #555; }
  th { background: rgba(255,255,255,0.1); }
  tr:hover { background: rgba(255,255,255,0.1); }
  .delete-btn { background-color: #e60000; }
  .delete-btn:hover { background-color: #ff3333; }
  .flex-row { display: flex; gap: 10px; flex-wrap: wrap; }
  .flex-col { flex: 1; }
</style>
</head>
<body>

<div class="container">
  <h1>Admin Dashboard</h1>

  <!-- ---------- Add User Section ---------- -->
  <div class="section">
    <h2>Add New User</h2>
    <div class="flex-row">
      <div class="flex-col"><input type="text" id="newFullName" placeholder="Full Name"></div>
      <div class="flex-col"><input type="text" id="newAccountName" placeholder="Account Name"></div>
      <div class="flex-col"><input type="number" id="newBalance" placeholder="Initial Balance"></div>
    </div>
    <button id="addUserBtn">Add User</button>
  </div>

  <!-- ---------- Users Table ---------- -->
  <div class="section">
    <h2>Existing Users</h2>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Full Name</th>
          <th>Account Name</th>
          <th>Balance</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="usersTableBody">
        <!-- Users populated here -->
      </tbody>
    </table>
  </div>

  <!-- ---------- Add Transaction Section ---------- -->
  <div class="section">
    <h2>Add Transaction</h2>
    <div class="flex-row">
      <div class="flex-col">
        <select id="transactionUser">
          <!-- Users options -->
        </select>
      </div>
      <div class="flex-col"><input type="text" id="transactionType" placeholder="Transaction Type"></div>
      <div class="flex-col"><input type="number" id="transactionAmount" placeholder="Amount"></div>
      <div class="flex-col"><input type="text" id="transactionNarration" placeholder="Narration"></div>
    </div>
    <button id="addTransactionBtn">Add Transaction</button>
  </div>

  <!-- ---------- Transactions Table ---------- -->
  <div class="section">
    <h2>Transactions</h2>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>User ID</th>
          <th>Type</th>
          <th>Amount</th>
          <th>Narration</th>
          <th>Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="transactionsTableBody">
        <!-- Transactions populated here -->
      </tbody>
    </table>
  </div>
</div>

<script>
  // ---------- Supabase Setup ----------
  const supabaseUrl = 'https://saeufvynqmqcatlseedb.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNhZXVmdnlucW1xY2F0bHNlZWRiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzMTg3MDYsImV4cCI6MjA4NTg5NDcwNn0.zYEb_smm9YGH4fRnfsMJcjZo00lFbkdBBsF1XdL3FaE';
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  // ---------- Load Users ----------
  async function loadUsers() {
    const { data: users, error } = await supabase.from('profiles').select('*').order('full_name');
    if (error) { console.error(error); return; }

    const tbody = document.getElementById('usersTableBody');
    tbody.innerHTML = '';
    const userSelect = document.getElementById('transactionUser');
    userSelect.innerHTML = '<option value="">Select User</option>';

    users.forEach(user => {
      // Table row
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${user.id}</td>
        <td>${user.full_name}</td>
        <td>${user.account_name}</td>
        <td>${user.balance}</td>
        <td><button class="delete-btn" onclick="deleteUser('${user.id}')">Delete</button></td>
      `;
      tbody.appendChild(tr);

      // Select option for transactions
      const opt = document.createElement('option');
      opt.value = user.id;
      opt.textContent = `${user.full_name} (${user.account_name})`;
      userSelect.appendChild(opt);
    });
  }

  // ---------- Add User ----------
  document.getElementById('addUserBtn').onclick = async () => {
    const fullName = document.getElementById('newFullName').value;
    const accountName = document.getElementById('newAccountName').value;
    const balance = parseFloat(document.getElementById('newBalance').value);

    if (!fullName || !accountName || isNaN(balance)) return alert('All fields required');

    const { error } = await supabase.from('profiles').insert({ full_name: fullName, account_name: accountName, balance });
    if (error) return alert(error.message);

    alert('User added!');
    loadUsers();
  }

  // ---------- Delete User ----------
  async function deleteUser(userId) {
    if (!confirm('Are you sure you want to delete this user?')) return;
    const { error } = await supabase.from('profiles').delete().eq('id', userId);
    if (error) return alert(error.message);
    alert('User deleted');
    loadUsers();
  }

  // ---------- Load Transactions ----------
  async function loadTransactions() {
    const { data: txs, error } = await supabase.from('transactions').select('*').order('transaction_date', { ascending: false });
    if (error) { console.error(error); return; }

    const tbody = document.getElementById('transactionsTableBody');
    tbody.innerHTML = '';
    txs.forEach(tx => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${tx.id}</td>
        <td>${tx.user_id}</td>
        <td>${tx.transaction_type}</td>
        <td>${tx.amount}</td>
        <td>${tx.narration || ''}</td>
        <td>${new Date(tx.transaction_date).toLocaleString()}</td>
        <td><button class="delete-btn" onclick="deleteTransaction('${tx.id}')">Delete</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  // ---------- Add Transaction ----------
  document.getElementById('addTransactionBtn').onclick = async () => {
    const userId = document.getElementById('transactionUser').value;
    const type = document.getElementById('transactionType').value;
    const amount = parseFloat(document.getElementById('transactionAmount').value);
    const narration = document.getElementById('transactionNarration').value;

    if (!userId || !type || isNaN(amount)) return alert('All fields required');

    const { error } = await supabase.from('transactions').insert({
      user_id: userId,
      transaction_type: type,
      amount,
      narration,
      transaction_date: new Date()
    });

    if (error) return alert(error.message);
    alert('Transaction added!');
    loadTransactions();
  }

  // ---------- Delete Transaction ----------
  async function deleteTransaction(txId) {
    if (!confirm('Are you sure you want to delete this transaction?')) return;
    const { error } = await supabase.from('transactions').delete().eq('id', txId);
    if (error) return alert(error.message);
    alert('Transaction deleted');
    loadTransactions();
  }

  // ---------- Initial Load ----------
  loadUsers();
  loadTransactions();
</script>
</body>
</html>